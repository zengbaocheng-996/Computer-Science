# 可靠传输 流量控制

### TCP可靠传输

- 传输层 使用TCP实现可靠传输
- 网络层 提供尽最大努力交付，不可靠传输

可靠：保证接收方进程从缓存区读出的字节流与发送方发出的字节流是完全一样的。

TCP实现可靠传输的机制

1. 校验

   与UDP校验一样，增加伪首部

2. 序号

3. 确认

4. 重传

### TCP可靠传输机制

| 机制名 | 说明                                                         |
| ------ | ------------------------------------------------------------ |
| 序号   | TCP协议面向字节流，它为数据流中的每一个字节都编上一个序号。TCP首部中序号字段的值是指本报文段所发送的数据的第一个字节的序号。 |
| 确认   | TCP首部的确认号是指已接收到的数据中最后一个字节的序号加1，加1的目的是指出此时期望收到对方的下一个报文段中数据部分的第一个字节的序号。<br />TCP使用累计确认：确认号表示该序号之前的所有数据都已经正确接收。 |
| 重传   | 导致TCP对报文段进行重传的事件：<br />超时：TCP每发送一个报文段，就对这个报文段设置一次计时器。只要计时器设置的重传时间到期但还没有收到确认，就要重传这个报文段。<br />冗余ACK：每当比期望序号大的失序报文段到达时，发送一个冗余ACK，指明下一个期待的序号，当连续收到对同一个报文段的3个冗余ACK，就重传该报文。 |

### TCP流量控制

流量控制：让发送方慢点，要让接收方来得及接收，动态控制发送端发送窗口的大小。在通信过程中，接收方根据自己接收缓存的大小，动态地调整发送方的发送窗口大小，即接受窗口rwnd（接收方设置确认报文段的窗口字段来将rwnd通知给发送方），发送方的发送窗口取接收窗口rwnd和拥塞窗口cwnd的最小值。

- 接收窗口：由接收端维护，接收端当前的接受缓存大小。
- 拥塞窗口：由发送端维护，发送端根据当前网络的拥塞程度而确定的窗口值。
- 发送窗口：由发送端维护，发送端在接收到下一个确认前能够发送的最大字节数。
- 发送窗口=min(接收窗口，拥塞窗口)