# 微程序控制器的基本原理

![](1.png)

## 微程序控制器的设计思路

![](2.png)

指令是对程序的执行步骤的描述

微指令是对指令执行步骤的描述

采用“存储程序”的思想，CPU出厂前将所有指令的“微程序”存入“控制器存储器”中

微命令与微操作一一对用

微指令中可能包含多个微命令

指令是对微指令功能的“封装”

## 微程序控制器的基本结构

![](3.png)

## 微程序控制器的工作原理

![](4.png)

![](5.png)

![](6.png)

# 微指令的设计

## 微指令的格式

![](9.png)

1. 水平型微指令 一条微指令能定义多个可并行的微命令

   ![](7.png)

2. 垂直型微指令 一条微指令只能定义一个微命令，由微操作码字段规定具体功能

   ![](8.png)

3. 混合型微指令

相容性微命令：可以并行完成的微命令。

互斥性微命令：不允许并行完成的微命令。

## 微指令的编码方式

1. 水平型微指令 一条微指令能定义多个可并行的微命令。

   ![](10.png)

   ![](11.png)

   ![](12.png)



## 微指令的地址形成方式

1. 微指令的下地址字段指出

   微指令格式中设置一个下地址字段，由微指令的下地址字段直接指出后继微指令的地址，这种方式又称为断定方式。

2. 根据机器指令的操作码形成

   当机器指令取至指令寄存器后，微指令的地址由操作码经微地址形成部件形成。

3. 增量计数器法 (CMAR)+1 -> CMAR

4. 分支转移 转移方式：指明判别条件；转移地址：指明转移成功后的去向。

   ![](13.png)

5. 通过测试网络

6. 由硬件产生微程序入口地址

   第一条微指令地址 由专门硬件产生（用专门的硬件记录取指周期微程序首地址）

   中断周期 由硬件产生中断周期微程序首地址（用专门的硬件记录）

![](14.png)

# 微程序控制单元的设计

设计步骤：

1. 分析每个阶段的微操作序列

2. 写出对应机器指令的微操作命令及节拍安排

   - 写出每个周期所需要的微操作（参照硬布线）

   - 补充微程序控制器特有的微操作：

     a. 取指周期：

     每条指令结束之后都需要进行

     ​    Ad(CMDR)->CMAR

     ​    OP(IR)->微地址形成部件->CMAR

     ​    取指周期的最后一条微指令完成后，要根据指令操作码指定其执行周期的微程序首地址

     b. 执行周期：

     ​    Ad(CMDR)->CMAR

     ​    每条微指令结束之后都需要进行

3. 确定微指令格式

   根据微操作个数决定采用何种编码方式，以确定微指令的操作控制字段的位数。

   根据CM中存储的微指令总数，确定微指令的顺序控制字段的位数。

   最后按操作控制字段位数和顺序控制字段位数就可以确定微指令字长。

4. 编写微指令码点

![](15.png)

![](16.png)

## 微程序设计分类

1. 静态微程序设计和动态微程序设计

   静态 微程序无需改变，采用ROM

   动态 通过改变微指令和微程序改变机器指令

   ​         有利于仿真，采用EPROM

2. 毫微程序设计

   毫微程序设计的基本概念

   微程序设计用微程序解释机器指令

   毫微程序设计用毫微程序解释微程序

   毫微指令与微指令的关系好比微指令与机器指令的关系

3. 硬布线与微程序的比较

   |          | 微程序控制器                                                 | 硬布线控制器                                                 |
   | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
   | 工作原理 | 微操作控制信号以微程序的形式存放在控制存储器中，执行指令时读出即可 | 微操作控制信号由组合逻辑电路根据当前的指令码、状态和时序，即时产生 |
   | 执行速度 | 慢                                                           | 快                                                           |
   | 规整性   | 较规整                                                       | 繁琐、不规整                                                 |
   | 应用场合 | CISC CPU                                                     | RISC CPU                                                     |
   | 易扩充性 | 易扩充修改                                                   | 困难                                                         |

![](17.png)

# 指令流水线的基本概念

# 指令流水线的影响因素和分类

# 五段式指令流水线

# 多处理器系统的基本概念

# 硬件多线程的基本概念